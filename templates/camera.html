<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="/static/css/camera.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera</title>
</head>
<div class="container">
    <div class="logo-container">
        <img class="logo" src="../static/img/fin.svg" alt="Logo">
    </div>
    </div>
    <nav class="navbar">
        <div class="container">  
            <img src="../static/img/logo_one.svg" alt="Logo" class="navbar-logo">
          <ul class="navbar-nav">
            <li class="nav-item"><a style="color: grey;" href="{{ url_for('home') }}" class="nav-link">Home</a></li>
            <li class="nav-item"><a style="color: grey;" href="{{ url_for('about') }}" class="nav-link">About</a></li>
            <li class="nav-item"><a style="color: grey;" href="{{ url_for('contact') }}" class="nav-link">Contact</a></li>
            <li class="nav-item"><a style="color: grey;" href="{{ url_for('camera') }}" class="nav-link">Camera</a></li>
            <li class="nav-item"><a style="color: grey;" href="{{ url_for('ip') }}" class="nav-link">IP</a></li>
            <li class="nav-item"><a style="color: grey;" href="{{ url_for('link') }}" class="nav-link">Link</Link></a></li>
            <li class="nav-item"><a style="color: grey;" href="{{ url_for('photo') }}" class="nav-link">Photo</a></li>
          </ul>
        </div>
      </nav>  
<body>
<div class="button-container" onclick="handleClick()">
  <img src="../static/img/camera_icon.svg" alt="Image">
</div>
<div class="word">
  <h2>Open Camera</h2>
</div>
<div class="video-container"></div>

<script>
let cameraStream;
let cameraOpened = false;

async function openCamera() {
  try {
    cameraStream = await navigator.mediaDevices.getUserMedia({ video: true });
    const video = document.createElement('video');
    video.srcObject = cameraStream;
    video.autoplay = true;
    video.style.width = '100%';
    video.style.height = '100%';
    video.style.transform = 'scaleX(-1)';  // Flip the video horizontally

    const videoContainer = document.querySelector('.video-container');
    videoContainer.innerHTML = '';
    videoContainer.appendChild(video);
    videoContainer.style.display = 'block';

    // Count from 1 to 3 and take a photo on each count
    for (let count = 1; count <= 10; count++) {
      await new Promise(resolve => setTimeout(resolve, 1000)); // Wait for 1 second

      // Take photo and save in the dataset directory
      takePhoto(count);
    }

    // Close the camera after taking three photos
    closeCamera();
  } catch (err) {
    console.error('Error accessing the camera:', err);
  }
}

// ... (rest of your functions remain unchanged)


function takePhoto(count) {
  const canvas = document.createElement('canvas');
  const video = document.querySelector('video');
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  const context = canvas.getContext('2d');
  context.drawImage(video, 0, 0, canvas.width, canvas.height);

  // Convert the canvas content to a data URL
  const dataURL = canvas.toDataURL('image/jpeg');

  // Simulate saving the photo in the dataset directory
  savePhoto(dataURL, count);
}

function savePhoto(dataURL, count) {
  // In a real application, you would save the photo to the server or perform other actions.
  // For simplicity, this example logs the data URL to the console.
  console.log('Photo ' + count + ' saved:', dataURL);
}

function closeCamera() {
  if (cameraStream) {
    const tracks = cameraStream.getTracks();
    tracks.forEach(track => track.stop());
  }

  const videoContainer = document.querySelector('.video-container');
  videoContainer.innerHTML = '';
  videoContainer.style.display = 'none';
}

function handleClick() {
  const buttonContainer = document.querySelector('.button-container');

  if (cameraOpened) {
    closeCamera();
  } else {
    openCamera();
  }

  cameraOpened = !cameraOpened;
}
</script>
</body>
</html>
